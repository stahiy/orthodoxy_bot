# Парсер цитат с azbyka.ru/quotes/

Скрипты для парсинга православных цитат с сайта azbyka.ru и сохранения их в формате, совместимом с проектом.

## Структура

- `parse_quotes.php` - основной скрипт парсинга
- `parse_quotes_debug.php` - отладочный скрипт для анализа структуры HTML
- `README.md` - данная инструкция

## Использование

### 1. Отладка структуры HTML (рекомендуется сначала)

Перед запуском основного парсера рекомендуется проанализировать структуру HTML сайта:

```bash
php parsing/parse_quotes_debug.php
```

Этот скрипт:
- Загрузит первую страницу с цитатами
- Сохранит HTML в `parsing/debug_page.html`
- Проанализирует структуру и выведет возможные селекторы
- Покажет примеры найденных элементов

Используйте результаты для корректировки селекторов в `parse_quotes.php`, если парсер не находит цитаты.

### 2. Основной парсинг

```bash
# Парсинг 10 страниц (по умолчанию)
php parsing/parse_quotes.php

# Парсинг большего количества страниц
php parsing/parse_quotes.php --max-pages=50

# Указать другой файл вывода
php parsing/parse_quotes.php --output=data/quotes.php
```

## Параметры

### parse_quotes.php

- `--max-pages=N` - максимальное количество страниц для парсинга (по умолчанию: 10)
- `--output=path` - путь к файлу для сохранения результатов (по умолчанию: `data/quotes.php`)

### parse_quotes_debug.php

- `--url=URL` - URL для анализа (по умолчанию: `https://azbyka.ru/quotes/`)

## Формат выходных данных

Результаты сохраняются в PHP-файл в формате массива строк, совместимом с текущим `data/quotes.php`:

```php
<?php

/**
 * Православные цитаты с azbyka.ru/quotes/
 * Сгенерировано: 2024-01-15 12:00:00
 * Всего цитат: 150
 */
return [
    "Текст цитаты (прав. Иоанн Кронштадтский)",
    "Другая цитата (прп. Иоанн Лествичник)",
    // ...
];
```

## Особенности

1. **Задержка между запросами**: 2 секунды, чтобы не перегружать сервер
2. **Проверка дубликатов**: цитаты не дублируются в результате
3. **Обработка авторов**: автоматическое извлечение авторов цитат
4. **Пагинация**: автоматический переход на следующие страницы
5. **Обработка ошибок**: скрипт продолжает работу при ошибках загрузки отдельных страниц

## Настройка селекторов

Если парсер не находит цитаты, используйте `parse_quotes_debug.php` для анализа структуры HTML и обновите селекторы в методах:

- `parsePage()` - поиск блоков с цитатами
- `extractQuoteText()` - извлечение текста цитаты
- `extractAuthor()` - извлечение автора
- `findNextPage()` - поиск следующей страницы

## Требования

- PHP 8.2+
- Расширение `curl`
- Расширение `dom` (для DOMDocument)
- Расширение `mbstring` (для работы с UTF-8)

## Примечания

- Скрипт использует User-Agent браузера для имитации обычного запроса
- Поддерживается автоматическая обработка кодировок (UTF-8)
- Результаты сохраняются с экранированием специальных символов

